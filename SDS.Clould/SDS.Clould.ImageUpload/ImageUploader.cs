namespace SDS.Clould.ImageUpload
{
    using System;

    using System.IO;
    using Telerik.Everlive.Sdk.Core;
    using Telerik.Everlive.Sdk.Core.Query.Definition.FormData;

    public class ImageUploader : IImageUploader
    {
        private const string EverliveAppKey = "yTpcS8cIlRXlVS2a";
        private const string TestBase = "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";
        
        private EverliveApp app;

        public ImageUploader()
        {
            app = new EverliveApp(EverliveAppKey);
        }

        public static string DefaultUrl
        {
            get
            {
                return "http://api.everlive.com/v1/yTpcS8cIlRXlVS2a/Files/730fbdc0-53f2-11e4-b2b7-0f2a33946566/Download";
            }
        }
        
        public string UrlFromBase64Image(string base64 = TestBase)
        {
            var stream = new MemoryStream(Convert.FromBase64String(base64));

            var uploadResult = app.WorkWith().Files().Upload(new FileField("fieldName", Guid.NewGuid().ToString(), "image/jpeg", stream)).ExecuteSync();

            var url = app.WorkWith().Files().GetFileDownloadUrl(uploadResult.Id);

            return url;
        }
    }
}